{"title":"APM Traces Ingestion Reasons Overview","description":"## APM Ingestion reasons overview\n\nMultiple mechanisms are responsible for choosing if spans generated by your applications are sent to Datadog (ingested). Sampling decisions based on these mechanisms are made through the tracing libraries and the Datadog Agent. Depending on user configuration, a fraction (or the entirety) of traffic generated by instrumented services is ingested.\n\nEach span ingested by Datadog includes an **ingestion reason** referring to the ingestion mechanism which made the decision to sample the span. Ingestion [estimated usage metrics](https://docs.datadoghq.com/tracing/trace_ingestion/usage_metrics/) are tagged by ingestion_reason.\n\nRead more about ingestion mechanisms in the [documentation](https://docs.datadoghq.com/tracing/trace_ingestion/mechanisms/)\n","widgets":[{"id":700864846558624,"definition":{"title":"Overview by Env and Service","background_color":"white","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":7984795013285236,"definition":{"title":"Ingested bytes by reason","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service} by {ingestion_reason}.as_count()","data_source":"metrics","name":"query9","aggregator":"sum"}],"formulas":[{"formula":"query9"}]}],"type":"sunburst","hide_total":false,"legend":{"type":"automatic"}},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":1524077764206562,"definition":{"title":"Ingestion reasons contributing to ingestion volume over time","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query9 / query1 * 100"}],"response_format":"timeseries","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service} by {ingestion_reason}.as_count()","data_source":"metrics","name":"query9"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service}.as_count()","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":4,"y":0,"width":8,"height":4}},{"id":1131460464371476,"definition":{"title":"MoM change in ingestion volume by reason","time":{"live_span":"1mo"},"type":"change","requests":[{"formulas":[{"formula":"month_before(query9)"},{"formula":"query9"}],"order_by":"present","order_dir":"desc","compare_to":"hour_before","response_format":"scalar","increase_good":false,"queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service} by {ingestion_reason}.as_count()","data_source":"metrics","name":"query9","aggregator":"sum"}],"change_type":"absolute"}]},"layout":{"x":0,"y":4,"width":4,"height":3}},{"id":8339378758534458,"definition":{"title":"Ingested bytes by reason over time","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query9"}],"response_format":"timeseries","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service} by {ingestion_reason}.as_count()","data_source":"metrics","name":"query9"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":4,"y":4,"width":8,"height":3}},{"id":5882935694295376,"definition":{"title":"Ingestion reasons contributing to volume by env and service","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query12","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:auto,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rule,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:manual,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:error,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query4","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rare,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query5","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:analytics,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query6","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:synthetics,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query7","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:synthetics-browser,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query9","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rum,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query10","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:xray,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query11","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:lambda,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query13","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:unknown,$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query14","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Total","formula":"query12"},{"alias":"Auto","formula":"query1"},{"alias":"Rule","formula":"query2"},{"alias":"Manual","formula":"query3"},{"alias":"Error","formula":"query4"},{"alias":"Rare","formula":"query5"},{"alias":"Analytics","formula":"query6"},{"alias":"Synthetics","formula":"query7"},{"alias":"Synthetics-browser","formula":"query9"},{"alias":"RUM","formula":"query10"},{"alias":"X-Ray","formula":"query11"},{"alias":"Lambda","formula":"query13"},{"alias":"Unknown","formula":"query14"}]}]},"layout":{"x":0,"y":7,"width":12,"height":6}},{"id":7568703008721542,"definition":{"title":"Total ingested bytes per service and ingestion reason","type":"treemap","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$service,$env,$ingestion_reason} by {service,ingestion_reason}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"formula":"query1"}]}]},"layout":{"x":0,"y":13,"width":12,"height":4}}]},"layout":{"x":0,"y":0,"width":12,"height":18}},{"id":4901284591546622,"definition":{"title":"Head-based sampling","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":8993250152916886,"definition":{"type":"note","content":"## Head-based sampling definition\n***ingestion_reason:auto*** & ***ingestion_reason:rule***\n\nThe default sampling mechanism is called head-based sampling. The decision of whether to keep or drop a trace is made at the very beginning of the trace, at the start of the root span. This decision is then propagated to other services as part of their request context.\n\nBecause the decision is made at the beginning of the trace and then conveyed to all downstream spans, the trace is guaranteed to be kept or dropped as a whole.\n\n### Notes\n\n- A higher level of head-based sampling decision will guarantee more complete traces.\n- Reducing the head-based sampling rate does not affect the collection of error or rare spans. \n\nRead more about head-based sampling in the [documentation](https://docs.datadoghq.com/tracing/trace_ingestion/mechanisms/?tab=environmentvariables#head-based-sampling)","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":7}},{"id":8348450247212266,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND (ingestion_reason:rule OR ingestion_reason:auto)}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":7547263418139090,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND (ingestion_reason:rule OR ingestion_reason:auto)}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":5725481723742678,"definition":{"title":"Contribution to overall volume compared to month before","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"current","formula":"query1 / query3 * 100"}],"response_format":"timeseries","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND (ingestion_reason:rule OR ingestion_reason:auto)}.as_count()","data_source":"metrics","name":"query1"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service}.as_count()","data_source":"metrics","name":"query3"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"},{"formulas":[{"alias":"month_before","formula":"calendar_shift(query1 / query0 * 100, '-4w', 'UTC')"}],"response_format":"timeseries","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND (ingestion_reason:rule OR ingestion_reason:auto)}.as_count()","data_source":"metrics","name":"query1"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service}.as_count()","data_source":"metrics","name":"query0"}],"style":{"palette":"dog_classic","line_type":"dashed","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":2,"width":8,"height":2}},{"id":8942820383290046,"definition":{"title":"Span volume by env and service","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND $ingestion_reason AND (ingestion_reason:rule OR ingestion_reason:auto)} by {env,service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service} by {env,service}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Span volume","formula":"query1"},{"alias":"% contribution to env/service volume","formula":"query1 / query2 * 100"}]}]},"layout":{"x":4,"y":4,"width":8,"height":3}},{"id":8986596640718916,"definition":{"type":"note","content":"## Agent configuration\n***ingestion_reason:auto***\n\nLearn how to [configure sampling in the agent](https://docs.datadoghq.com/tracing/trace_ingestion/mechanisms/?tab=environmentvariables#head-based-sampling)","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":7,"width":4,"height":2}},{"id":5992737265960788,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,ingestion_reason:auto}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":7,"width":4,"height":2}},{"id":3206528224294916,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:auto,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2},"layout":{"x":8,"y":7,"width":4,"height":2}},{"id":6715365919395712,"definition":{"type":"note","content":"## Tracing Library configuration\n***ingestion_reason:rule***\n\nLearn how to [configure sampling in the tracing libraries](https://docs.datadoghq.com/tracing/trace_ingestion/mechanisms/?tab=environmentvariables#in-tracing-libraries-user-defined-rules)","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":9,"width":4,"height":2}},{"id":6513388245004488,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,ingestion_reason:rule}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":9,"width":4,"height":2}},{"id":2553542071525622,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rule,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2},"layout":{"x":8,"y":9,"width":4,"height":2}}]},"layout":{"x":0,"y":18,"width":12,"height":12}},{"id":1935652457399292,"definition":{"title":"Additional sampling configuration","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2455657173631450,"definition":{"type":"note","content":"# Error Traces \n\n***ingestion_reason:error***\n\nIn addition to traces sampled by head-based sampling, the agent collects error spans in order to provide visibility on potential system failures.\n\nBy default, each agent samples up to 10 errors per second.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":5}},{"id":3160134553175300,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:error,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":7971110292003756,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:error,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":6218893604821336,"definition":{"title":"Span volume by env and service","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:error,$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Span volume","formula":"query1"},{"alias":"% contribution to service/env volume","formula":"query1 / query2 * 100"}]}]},"layout":{"x":4,"y":2,"width":8,"height":3}},{"id":6535008943483172,"definition":{"type":"note","content":"# Rare Traces\n\n***ingestion_reason:rare***\n\nIn addition to traces sampled by head-based sampling, the agent collects rare spans in order to keep visibility on your system as a whole, by making sure that low-traffic services and resources are still monitored.\n\nIt catches unique combinations of `service`, `name`, `resource`, `http.status_code` and `error.type`.\n\nBy default, each agent samples up to 5 rare traces per second.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":5,"width":4,"height":5}},{"id":8582244023643072,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rare,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":4,"y":5,"width":4,"height":2}},{"id":2882673172695714,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rare,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":8,"y":5,"width":4,"height":2}},{"id":4594317813931928,"definition":{"title":"Span volume by env and service","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rare,$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Span volume","formula":"query1"},{"alias":"% contribution to service/env volume","formula":"query1 / query2 * 100"}]}]},"layout":{"x":4,"y":7,"width":8,"height":3}},{"id":825214660747020,"definition":{"type":"note","content":"# App Analytics\n\n***ingestion_reason:analytics***\n\n[App Analytics a deprecated mechanism](https://docs.datadoghq.com/tracing/trace_ingestion/mechanisms/#single-spans-app-analytics)\n\nWith App Analytics, spans are ingested as single spans without the full trace. Use head-based sampling instead to ensure full traces are kept.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":10,"width":4,"height":5}},{"id":5742033894686830,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:analytics,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":4,"y":10,"width":4,"height":2}},{"id":2436614298805706,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:analytics,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":8,"y":10,"width":4,"height":2}},{"id":4921471970242132,"definition":{"title":"Span volume by env and service","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:analytics,$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Span volume","formula":"query1"},{"alias":"% contribution to service/env volume","formula":"query1 / query2 * 100"}]}]},"layout":{"x":4,"y":12,"width":8,"height":3}},{"id":2510655850450962,"definition":{"type":"note","content":"# Force keep and drop\n\n***ingestion_reason:manual***\n\nThe head-based sampling mechanism can be overridden at the tracing library level. \n\nFor example: \n- If you need to monitor a critical transaction, you can force the associated trace to be kept.\n- For unnecessary or repetitive information like health checks, you can force the trace to be dropped.\n\n","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":15,"width":4,"height":5}},{"id":5458837826915764,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:manual,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":4,"y":15,"width":4,"height":2}},{"id":7906900552914410,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:manual,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":8,"y":15,"width":4,"height":2}},{"id":979732199284556,"definition":{"title":"Span volume by env and service","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:analytics,$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,$ingestion_reason} by {env,service}.as_count()","data_source":"metrics","name":"query2","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Span volume","formula":"query1"},{"alias":"% contribution to service/env volume","formula":"query1 / query2 * 100"}]}]},"layout":{"x":4,"y":17,"width":8,"height":3}}]},"layout":{"x":0,"y":30,"width":12,"height":21,"is_column_break":true}},{"id":3117020488602768,"definition":{"title":"Product ingested spans","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":7890591841490170,"definition":{"type":"note","content":"# RUM \n\n***ingestion_reason:rum***\n\n\nIf you are using Datadog RUM alongside Datadog APM you have the ability to bind the two products together in order to gain end-to-end visibility.\n\nTraces are generated from browser services in order to track the end-to-end requests from front end to back end.\n\nSee the [Connect RUM and Traces](https://docs.datadoghq.com/real_user_monitoring/connect_rum_and_traces/) documentation","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":2796147567736492,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rum,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":0,"width":2,"height":2}},{"id":1260346376291042,"definition":{"type":"note","content":"# Synthetics\n\n***ingestion_reason:synthetics or ingestion_reason:synthetics_browser***\n\n\nIf you are using Datadog Synthetics product alongside Datadog APM you have the ability to bind the two products together in order to gain end-to-end visibility.\n\nTraces are generated from API tests and browser tests if services are instrumented with APM. \n\nSee the [Connect Synthetic and Traces](https://docs.datadoghq.com/synthetics/apm/) documentation.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":6,"y":0,"width":4,"height":4}},{"id":8390908818477084,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:synthetics OR ingestion_reason:synthetics_browser AND $env AND $service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":10,"y":0,"width":2,"height":2}},{"id":1799309614046442,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:rum,$env,$service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":2,"width":2,"height":2}},{"id":1551315064676006,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND ingestion_reason:synthetics OR ingestion_reason:synthetics_browser}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":true,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":10,"y":2,"width":2,"height":2}},{"id":545347482904458,"definition":{"type":"note","content":"# Serverless \n\n***ingestion_reason:serverless or ingestion_reason:xray***\n\n\nIf you are using Datadog Serverless alongside Datadog APM, traces from your AWS Lambda functions and AWS Xray are automatically kept for end-to-end visibility.\n","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":4,"width":4,"height":4}},{"id":1760927669167120,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{ingestion_reason:lambda OR ingestion_reason:xray AND $env AND $service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":4,"width":2,"height":2}},{"id":1109834348203280,"definition":{"type":"note","content":"# Application Security \n\n***ingestion_reason:appsec***\n\n\nIf you are using Datadog Application Security Management (ASM) alongside Datadog APM, all spans monitored by ASM are kept.\n","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":6,"y":4,"width":4,"height":4}},{"id":471562174352838,"definition":{"title":"Span volume","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,ingestion_reason:appsec}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":10,"y":4,"width":2,"height":2}},{"id":2972317378305710,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env AND $service AND ingestion_reason:lambda OR ingestion_reason:xray}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":false,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":4,"y":6,"width":2,"height":2}},{"id":1195379047421628,"definition":{"title":"Contribution to overall volume","type":"query_value","requests":[{"formulas":[{"formula":"query1 / query3 * 100"}],"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{$env,$service,ingestion_reason:appsec}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"},{"query":"sum:datadog.estimated_usage.apm.ingested_bytes{*}.as_count()","data_source":"metrics","name":"query3","aggregator":"sum"}]}],"autoscale":false,"custom_unit":"%","precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":10,"y":6,"width":2,"height":2}}]},"layout":{"x":0,"y":51,"width":12,"height":9}}],"template_variables":[{"name":"env","prefix":"env","available_values":[],"default":"*"},{"name":"service","prefix":"service","available_values":[],"default":"*"},{"name":"ingestion_reason","prefix":"ingestion_reason","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed"}