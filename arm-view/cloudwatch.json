jq . apm_ingestion_dashboard.json >/dev/null && echo "JSON OK"

aws cloudwatch put-dashboard \
  --dashboard-name "APM-Traces-Ingestion-Reasons-Overview" \
  --dashboard-body file://apm_ingestion_dashboard.json


ENV_LIST=("idev" "uat")
REASONS=("auto" "error" "rare" "rule" "manual" "analytics" "synthetics" "synthetics-browser" "rum" "xray" "lambda" "appsec" "unknown")
for ENV in "${ENV_LIST[@]}"; do
  for R in "${REASONS[@]}"; do
    aws cloudwatch put-metric-data --namespace "Custom/APM" --metric-data "[
      {\"MetricName\":\"IngestedBytes\",\"Dimensions\":[
        {\"Name\":\"Env\",\"Value\":\"$ENV\"},
        {\"Name\":\"Service\",\"Value\":\"checkout\"},
        {\"Name\":\"IngestionReason\",\"Value\":\"$R\"}],
       \"Value\":$(( (RANDOM%50+1)*1024*1024 )),\"Unit\":\"Bytes\",\"StorageResolution\":60}
    ]"
  done
done
